<div id="form-wrapper">
  <button class="mdl-button mdl-js-button mdl-js-ripple-effect" hx-get="/storage_workers/list" hx-trigger="click"
    hx-target="#form-wrapper" hx-swap="outerHTML transition:true">
    Back
  </button>

  <h1>Register storage worker</h1>
  <div>
    First, you need to create a telegram bot by using <a href="https://telegram.me/BotFather">the BotFather</a>.<br />
    Once you have done, he will provide you with a token.<br />
    <strong>Remember that both name and token must be unique across your storage workers</strong>
  </div>

  <form action="/storage_workers" method="POST" class="form" hx-post="/storage_workers" hx-target="#form-wrapper"
    hx-swap="outerHTML transition:true">

    {% match name_err %}
    {% when Some with (error_msg) %}
    <div class="mdl-textfield mdl-js-textfield is-invalid">
      <input class="mdl-textfield__input" name="name" id="name" required>
      <label class="mdl-textfield__label" for="name">Name</label>
      <span class="mdl-textfield__error">{{ error_msg }}</span>
    </div>

    {% when None %}
    <div class="mdl-textfield mdl-js-textfield">
      <input class="mdl-textfield__input" name="name" id="name" required>
      <label class="mdl-textfield__label" for="name">Name</label>
    </div>
    {% endmatch %}

    {% match token_err %}
    {% when Some with (error_msg) %}
    <div class="mdl-textfield mdl-js-textfield is-invalid">
      <input class="mdl-textfield__input" name="token" id="token" required>
      <label class="mdl-textfield__label" for="token">Token</label>
      <span class="mdl-textfield__error">{{ error_msg }}</span>
    </div>

    {% when None %}
    <div class="mdl-textfield mdl-js-textfield">
      <input class="mdl-textfield__input" name="token" id="token" required>
      <label class="mdl-textfield__label" for="token">Token</label>
    </div>
    {% endmatch %}

    <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored">
      Register
    </button>

  </form>

  <script>
    document.body.addEventListener('htmx:beforeOnLoad', (evt) => {
      if (evt.detail.xhr.status === 409) {
        evt.detail.shouldSwap = true;
        evt.detail.isError = false;
      }
    });
  </script>

</div>
